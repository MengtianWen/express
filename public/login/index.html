<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>登录</title>
    <link rel="manifest" href="mainfest/login-mainfest.json">
    <link rel="dns-prefetch" href="https://luneice.com">
    <link rel="dns-prefetch" href="https://signup.luneice.com">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
</head>
<style type="text/css">
    body{
        padding: 0;
        margin: 0;
        width: 100%;
        font-size: 16px;
        min-width: 320px;
        background-color: #FFFFFF;
    }
    
    a{
        color: #5e5e5e;
        margin-top: 15px;
        display: inline-block;
    }
    
    input{
        border: none;
        outline: none;
        text-indent: .2em;
        letter-spacing: .2em;
        font-size: inherit;
        background-color: inherit;
    }
    
    .title-cont{
        width: 90%;
        min-width: 320px;
        max-width: 760px;
        margin: 0 auto;
    }
    
    .body-cont{
        width: 90%;
        min-width: 320px;
        max-width: 760px;
        margin: 25px auto;
    }
    
    .login-cont{
        margin: 0 auto;
        position: relative;
        background-color: #FFFFFF;
    }
    
    .login-ipt--comm{
        position: relative;
        margin-top: 25px;
        align-items: center;
        font-size: inherit;
        --input-height: 35px;
    }
    
    .login-ipt--comm > input{
        width: 100%;
        height: var(--input-height);
    }
    
    .login-ipt--comm > input ~ label{
        left: .5em;
        bottom: .5em;
        color: #5e5e5e;
        letter-spacing: .2em;
        position: absolute;
        font-size: inherit;
        pointer-events: none;
    }
    
    .login-ipt--comm > input:invalid ~ label{
        -moz-transition: .2s cubic-bezier(0, .56, .05,1) all;
        -webkit-transition: .2s cubic-bezier(0, .56, .05,1) all;
        transition: .2s cubic-bezier(0, .56, .05,1) all;
    }
    
    .login-ipt--comm > input:focus ~ label, .login-ipt--comm > input:valid ~ label {
        left: -.2em;
        bottom: 2.5em;
        color: #9e9e9e;
        font-size: 14px;
    }
    
    .login-ipt--comm > input:focus ~ label{
        color: rgb(66, 166, 244);
    }
    
    .login-ipt--comm > input ~ span{
        width: 100%;
        display: block;
        margin: 0 auto;
        position: relative;
        border-top: 1px solid #9e9e9e;
        border-bottom: 1px solid transparent;
    }
    
    .login-ipt--comm > input ~ span:after, .login-ipt--comm > input ~ span:before{
        content: '';
        width: 0;
        bottom: 0;
        position: absolute;
        border-bottom: 2px solid rgb(66, 166, 244);
        -moz-transition: .2s cubic-bezier(0, .56, .05, 1) all;
        -webkit-transition: .2s cubic-bezier(0, .56, .05, 1) all;
        transition: .2s cubic-bezier(0, .56, .05, 1) all;
    }
    
    .login-ipt--comm > input ~ span:after{
        left: 50%;
    }
    
    .login-ipt--comm > input ~ span:before{
        right: 50%;
    }
    
    .login-ipt--comm > input:focus ~ span:after, .login-ipt--comm > input:focus ~ span:before{
        width: 50%;
    }
    
    .login-ipt--comm > input.wrong ~ span:after, .login-ipt--comm > input.wrong ~ span:before{
        width: 50%;
        border-bottom: 2px solid #ea4335;
    }
    
    .login-ipt--comm > input ~ p{
        margin: 0;
        right: 0;
        bottom: 2.5em;
        font-size: 14px;
        position: absolute;
        display: inline-block;
    }
    
    .login-ipt--comm > input.wrong ~ p{
        color: #ea4335;
    }
    
    .forget{
        margin: 0 auto;
        margin-bottom: 30px;
    }
    
    .toast{
        left: 0;
        right: 0;
        width: 75%;
        bottom: 50%;
        height: 80px;
        color: #ea4335;
        margin: 0 auto;
        line-height: 80px;
        border-radius: 2px;
        position: absolute;
        text-align: center;
        background-color: #FFFFFF;
        box-shadow: 1px 1px 4px 0 rgba(120, 120,120, .5),
        -1px -1px 4px 0 rgba(120, 120,120, .5);
    }
    
    input[type='button']{
        height: 38px;
        text-indent: 1em;
        letter-spacing: 1em;
        border-radius: 2px;
        background-color: rgba(66, 166, 244, .8);
        box-shadow: 0 1px 3px 0 rgba(100, 100, 100, .6);
    }
    
    input[type='button']:active{
        background-color: rgba(66, 166, 244, 1);
    }

</style>
<body>
<div class="logo-cont"></div>
<div class="title-cont">
    <h3>登录</h3>
</div>
<div class="body-cont">
    <div class="login-cont">
        <div class="login-ipt--comm username">
            <input title="用户名" id="username" required>
            <label>学号|邮箱</label>
            <span></span>
            <p></p>
        </div>
        <div class="login-ipt--comm password">
            <input title="密码" id="password" type="password" required>
            <label>密码</label>
            <span></span>
            <p></p>
        </div>
        <div class="login-ipt--comm forget">
            <a target="_blank" href="../find/find.html" class="find">忘记密码?</a>
        </div>
        <div class="login-ipt--comm toast" style="display: none;">
            用户名或密码错误
        </div>
        <div class="login-ipt--comm submit">
            <input title="登录" class="login" type="button" value="登录">
            <p></p>
        </div>
    </div>
</div>
<script src='./js/jquery-3.2.1.min.js'></script>
<script type="text/javascript">
	(function (window) {
		var AL = AL || {};
		/*模型层*/
		AL.M = (function () {
			var user = {};
			var username = '', password = '';
			var User = function (username, password) {
				this.username = username;
				this.password = password;
				this.time = new Date().getTime();
				return this;
			};

			var login = function (callback) {
				$.ajax({
					url: '/login/',
					type: 'post',
					timeout: 8000,
					dataType: 'json',
					data: user,
					success: function (res, textStatus) {
						callback(res, textStatus);
					},
					error: function (res, textStatus) {
						callback(res, textStatus);
					}
				});
			};

			return {
				setUsername: function (str) {
					username = str;
					return true;
				},
				setPassword: function (str) {
					password = str;
					return true;
				},
				createUser: function () {
					user = new User(username, password);
				},
				login: login
			}
		})();

		/*视图层*/
		AL.V = (function () {
			var notice = {
				correct: function (that) {
					var input = $(that);
					input.removeClass('wrong').siblings('p').removeClass('wrong')[0].innerText = '';
				},
				error: function (that, str) {
					var input = $(that);
					input.addClass('wrong').siblings('p').addClass('wrong')[0].innerText = str;
				},
				failure: function () {
					/*用户名或密码错误的提示*/
					$('.toast').stop(true).fadeIn().delay(1500).fadeOut();
				}
			};

			return {
				notice: notice
			}
		})();

		/*控制层*/
		AL.C = (function () {
			var M = AL.M;
			var V = AL.V;
			var inputArr = $('.login-ipt--comm > input');

			var check = {
				username: function () {
					var username = inputArr[0].value;
					return ((/^201[3-9][0-9]{5,6}$/.test(username)) ||
							(/^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$/.test(username))) ?
							M.setUsername(username) : false;
				},
				password: function () {
					var password = inputArr[1].value;
					return (/^[A-Za-z0-9!@#$%^&*()_+-=|\\/?<>,.:;]{6,18}$/.test(password)) ? M.setPassword(password) : false;
				}
			};

			var verify = {
				username: function () {
					check.username() ? V.notice.correct(inputArr[0]) : V.notice.error(inputArr[0], '用户名非法');
				},
				password: function () {
					check.password() ? V.notice.correct(inputArr[1]) : V.notice.error(inputArr[1], '密码非法');
				}
			};

			/*用户名合法性验证提示*/
			$(inputArr).on('blur', function () {
				var id = $(this)[0].getAttribute('id');
				verify[id]();
			});


			/*监听登录按钮事件*/
			$('.login').on('click', function () {
				if (check.username() && check.password()){
					/*如果输入的信息合法则登录*/
					M.createUser();
					M.login(function (res) {
						if (res['success'] === true ){
							/*登陆成功*/
							window.location = 'https://luneice.com';
						}else {/*登录失败*/

							V.notice.failure();
						}
					});
				}else {
					/*输入信息非法*/
					verify.username();
					verify.password();
				}
			});
		})();

		window.AL = AL;
	})(window);
</script>
</body>
</html>
